<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Demo Bot -->
        <record id="demo_bot_customer_service" model="wa.bot">
            <field name="name">Customer Service Bot</field>
            <field name="active">True</field>
            <field name="init_mode">auto</field>
            <field name="session_timeout">30</field>
            <field name="greeting_enabled">True</field>
            <field name="greeting_message">Ol√°! üëã Bem-vindo ao nosso atendimento automatizado.
Como posso ajudar voc√™ hoje?</field>
        </record>

        <!-- Flow Step 1: Menu de Op√ß√µes -->
        <record id="flow_step_menu" model="wa.bot.flow">
            <field name="name">Menu Principal</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">10</field>
            <field name="step_type">question</field>
            <field name="message">Por favor, escolha uma op√ß√£o:

1Ô∏è‚É£ - Informa√ß√µes sobre produtos
2Ô∏è‚É£ - Suporte t√©cnico  
3Ô∏è‚É£ - Falar com atendente
4Ô∏è‚É£ - Hor√°rio de funcionamento

Digite o n√∫mero da op√ß√£o desejada:</field>
            <field name="question_variable">menu_option</field>
            <field name="question_validation">custom</field>
            <field name="validation_code">valid = answer.strip() in ['1', '2', '3', '4']
error_message = 'Por favor, digite um n√∫mero de 1 a 4'</field>
            <field name="validation_error_message">Op√ß√£o inv√°lida. Digite um n√∫mero de 1 a 4.</field>
        </record>

        <!-- Flow Step 2: Condition - Verificar Op√ß√£o -->
        <record id="flow_step_check_option" model="wa.bot.flow">
            <field name="name">Verificar Op√ß√£o Escolhida</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">20</field>
            <field name="step_type">condition</field>
            <field name="condition_type">variable</field>
            <field name="condition_variable">menu_option</field>
            <field name="condition_operator">==</field>
            <field name="condition_value">1</field>
        </record>

        <!-- Flow Step 3A: Op√ß√£o 1 - Produtos -->
        <record id="flow_step_produtos" model="wa.bot.flow">
            <field name="name">Informa√ß√µes de Produtos</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">30</field>
            <field name="step_type">message</field>
            <field name="message">üì¶ **Nossos Produtos:**

Oferecemos uma linha completa de solu√ß√µes para sua empresa:
‚Ä¢ Sistema ERP Odoo
‚Ä¢ M√≥dulos personalizados
‚Ä¢ Integra√ß√µes WhatsApp
‚Ä¢ Consultoria especializada

Para mais informa√ß√µes, visite: www.exemplo.com.br

Deseja voltar ao menu principal? Digite *MENU*</field>
        </record>

        <!-- Flow Step 3B: Op√ß√£o 2 - Suporte -->
        <record id="flow_step_suporte" model="wa.bot.flow">
            <field name="name">Suporte T√©cnico</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">31</field>
            <field name="step_type">question</field>
            <field name="message">üõ†Ô∏è **Suporte T√©cnico**

Por favor, descreva brevemente seu problema:</field>
            <field name="question_variable">support_issue</field>
            <field name="question_validation">text</field>
        </record>

        <!-- Flow Step 3C: Op√ß√£o 3 - Atendente -->
        <record id="flow_step_atendente" model="wa.bot.flow">
            <field name="name">Solicitar Atendente</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">32</field>
            <field name="step_type">message</field>
            <field name="message">üë®‚Äçüíº **Atendimento Humano**

Entendi! Vou transferir voc√™ para um de nossos atendentes.
Por favor, aguarde um momento...

‚è∞ Tempo m√©dio de espera: 5 minutos</field>
        </record>

        <!-- Flow Step 3D: Op√ß√£o 4 - Hor√°rio -->
        <record id="flow_step_horario" model="wa.bot.flow">
            <field name="name">Hor√°rio de Funcionamento</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">33</field>
            <field name="step_type">message</field>
            <field name="message">üïê **Hor√°rio de Funcionamento:**

Segunda a Sexta: 8h √†s 18h
S√°bado: 8h √†s 12h
Domingo: Fechado

üìû WhatsApp 24h para mensagens
üöÄ Respostas em at√© 1 hora em hor√°rio comercial

Deseja voltar ao menu? Digite *MENU*</field>
        </record>

        <!-- Flow Step 4: Confirmar Suporte -->
        <record id="flow_step_confirm_suporte" model="wa.bot.flow">
            <field name="name">Confirmar Chamado de Suporte</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">40</field>
            <field name="step_type">message</field>
            <field name="message">‚úÖ **Chamado Registrado!**

Seu problema foi registrado:
"{support_issue}"

N√∫mero do chamado: #{phone}
Nossa equipe entrar√° em contato em breve.

Digite *MENU* para voltar ao menu principal.</field>
        </record>

        <!-- Link Flow Steps -->
        <record id="flow_step_menu" model="wa.bot.flow">
            <field name="next_step_id" ref="flow_step_check_option"/>
        </record>

        <record id="flow_step_check_option" model="wa.bot.flow">
            <field name="next_step_true_id" ref="flow_step_produtos"/>
        </record>

        <!-- Condition for Option 2 -->
        <record id="flow_step_check_option_2" model="wa.bot.flow">
            <field name="name">Verificar Op√ß√£o 2</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">21</field>
            <field name="step_type">condition</field>
            <field name="condition_type">variable</field>
            <field name="condition_variable">menu_option</field>
            <field name="condition_operator">==</field>
            <field name="condition_value">2</field>
            <field name="next_step_true_id" ref="flow_step_suporte"/>
        </record>

        <!-- Condition for Option 3 -->
        <record id="flow_step_check_option_3" model="wa.bot.flow">
            <field name="name">Verificar Op√ß√£o 3</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">22</field>
            <field name="step_type">condition</field>
            <field name="condition_type">variable</field>
            <field name="condition_variable">menu_option</field>
            <field name="condition_operator">==</field>
            <field name="condition_value">3</field>
            <field name="next_step_true_id" ref="flow_step_atendente"/>
        </record>

        <!-- Condition for Option 4 -->
        <record id="flow_step_check_option_4" model="wa.bot.flow">
            <field name="name">Verificar Op√ß√£o 4</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="sequence">23</field>
            <field name="step_type">condition</field>
            <field name="condition_type">variable</field>
            <field name="condition_variable">menu_option</field>
            <field name="condition_operator">==</field>
            <field name="condition_value">4</field>
            <field name="next_step_true_id" ref="flow_step_horario"/>
        </record>

        <!-- Link Conditions Chain -->
        <record id="flow_step_check_option" model="wa.bot.flow">
            <field name="next_step_false_id" ref="flow_step_check_option_2"/>
        </record>

        <record id="flow_step_check_option_2" model="wa.bot.flow">
            <field name="next_step_false_id" ref="flow_step_check_option_3"/>
        </record>

        <record id="flow_step_check_option_3" model="wa.bot.flow">
            <field name="next_step_false_id" ref="flow_step_check_option_4"/>
        </record>

        <!-- Link Suporte to Confirmation -->
        <record id="flow_step_suporte" model="wa.bot.flow">
            <field name="next_step_id" ref="flow_step_confirm_suporte"/>
        </record>

        <!-- Demo Command: MENU -->
        <record id="demo_command_menu" model="wa.bot.command">
            <field name="name">Voltar ao Menu</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="command">/menu</field>
            <field name="description">Retorna ao menu principal</field>
            <field name="python_code"># Reiniciar fluxo do menu
first_step = env['wa.bot.flow'].search([
    ('bot_id', '=', session.bot_id.id),
    ('name', '=', 'Menu Principal')
], limit=1)

if first_step:
    first_step.execute(session)
    result = {'ok': True, 'text': ''}
else:
    result = {'ok': True, 'text': 'Menu n√£o encontrado.'}</field>
        </record>

        <!-- Demo Command: HELP -->
        <record id="demo_command_help" model="wa.bot.command">
            <field name="name">Ajuda</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="command">/help</field>
            <field name="description">Mostra comandos dispon√≠veis</field>
            <field name="python_code">result = {
    'ok': True,
    'text': '''ü§ñ **Comandos Dispon√≠veis:**

/menu - Voltar ao menu principal
/help - Esta mensagem de ajuda
/status - Status da sua sess√£o

Digite qualquer uma dessas op√ß√µes para usar!'''
}</field>
        </record>

        <!-- Demo Command: STATUS -->
        <record id="demo_command_status" model="wa.bot.command">
            <field name="name">Status</field>
            <field name="bot_id" ref="demo_bot_customer_service"/>
            <field name="command">/status</field>
            <field name="description">Mostra informa√ß√µes da sess√£o</field>
            <field name="python_code">from datetime import datetime

tempo_ativo = datetime.now() - session.start_time
minutos = int(tempo_ativo.total_seconds() / 60)

result = {
    'ok': True,
    'text': f'''üìä **Status da Sess√£o:**

üë§ Contato: {session.contact_name or 'N√£o identificado'}
üì± Telefone: {session.phone}
‚è±Ô∏è Tempo ativo: {minutos} minutos
üí¨ Mensagens: {session.message_count}
ü§ñ Bot: {session.bot_id.name}

Tudo funcionando perfeitamente! ‚úÖ'''
}</field>
        </record>

    </data>
</odoo>
